# Description: The Kmod package contains libraries and utilities for loading kernel modules
# URL: http://www.kernel.org/pub/linux/kernel/people/rusty/modules
# Maintainer: linux-modules at vger dot kernel dot org
# Packager: pierre^
PKGMK_GROUPS=(devel doc man)
source=(http://www.kernel.org/pub/linux/utils/kernel/kmod/kmod-$version.tar.xz )
build()
{
cd $name-$version
PKG_CONFIG_PATH="/usr/lib/pkgconfig" ./configure --prefix=/usr \
--bindir=/bin \
--sysconfdir=/etc \
--disable-manpages \
--with-xz \
--with-zlib

make
make check
make DESTDIR=$PKG pkgconfigdir=/usr/lib/pkgconfig install
mkdir $PKG/sbin
for target in depmod insmod modinfo modprobe rmmod; do
  ln -sv ../bin/kmod $PKG/sbin/$target
done
ln -sv kmod $PKG/bin/lsmod
mkdir -v $PKG/lib
mv -v $PKG/usr/lib/libkmod.so.* \
$PKG/lib
ln -svf ../../lib/libkmod.so.2.2.5 $PKG/usr/lib/libkmod.so
}
devel()
{
cd $PKG
bsdtar -cf \
$PKGMK_PACKAGE_DIR/$name.devel#$version-$release-any.pkg.tar \
usr/lib \
usr/include \
usr/share/bash-completion
rm -r usr/lib \
usr/include \
usr/share/bash-completion
}

